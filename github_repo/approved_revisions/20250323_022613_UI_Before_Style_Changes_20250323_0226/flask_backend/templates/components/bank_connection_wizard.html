<!-- Bank Connection Wizard Modal -->
<div class="modal fade" id="bankConnectionModal" tabindex="-1" aria-labelledby="bankConnectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h5 class="modal-title" id="bankConnectionModalLabel">Connect to Your Bank</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <!-- Wizard Progress -->
                <div class="wizard-progress py-2 px-4 bg-light border-bottom">
                    <div class="d-flex justify-content-between align-items-center position-relative">
                        <div class="progress position-absolute" style="height: 2px; width: 100%; z-index: 1;">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div class="step d-flex flex-column align-items-center" style="z-index: 2;">
                            <div class="step-icon bg-primary text-white d-flex align-items-center justify-content-center">
                                <span>1</span>
                            </div>
                            <div class="step-label">Select Bank</div>
                        </div>
                        <div class="step d-flex flex-column align-items-center" style="z-index: 2;">
                            <div class="step-icon bg-light border d-flex align-items-center justify-content-center">
                                <span>2</span>
                            </div>
                            <div class="step-label">Authorize</div>
                        </div>
                        <div class="step d-flex flex-column align-items-center" style="z-index: 2;">
                            <div class="step-icon bg-light border d-flex align-items-center justify-content-center">
                                <span>3</span>
                            </div>
                            <div class="step-label">Complete</div>
                        </div>
                    </div>
                </div>
                
                <div class="p-4">
                    <!-- Step 1: Select Bank -->
                    <div class="step-content step-1">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-2">Select Your Bank</h5>
                                <p class="text-muted mb-3">Choose your financial institution from the list below.</p>
                                
                                <div class="form-group mb-3">
                                    <div class="input-group">
                                        <span class="input-group-text bg-white">
                                            <i data-lucide="search" style="width: 16px; height: 16px;"></i>
                                        </span>
                                        <input type="text" class="form-control" id="bankSearchInput" placeholder="Search for your bank...">
                                    </div>
                                </div>
                                
                                <div class="form-group mb-3">
                                    <select class="form-select" id="bankCountryFilter">
                                        <option value="GB" selected>United Kingdom</option>
                                        <option value="DE">Germany</option>
                                        <option value="FR">France</option>
                                        <option value="ES">Spain</option>
                                        <option value="IT">Italy</option>
                                        <option value="NL">Netherlands</option>
                                        <option value="IE">Ireland</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-info mb-0 d-flex align-items-center">
                                    <i data-lucide="info" class="me-2 flex-shrink-0" style="width: 18px; height: 18px;"></i>
                                    <div class="small">
                                        <strong>Open Banking connectivity</strong>
                                        <div>We support over 2,400 banks across Europe. If you don't see your bank listed, try using the search.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row bank-options-container">
                            <!-- Banks will be dynamically loaded here -->
                            <div class="text-center p-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading available banks...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2: Authorize Bank -->
                    <div class="step-content step-2 d-none">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="mb-3">Connect to Bank</h5>
                                <p class="text-muted">You'll be redirected to your bank's website to securely authorize access.</p>
                                
                                <div class="auth-permissions mt-4">
                                    <h6 class="mb-2">You're granting permission to:</h6>
                                    <div class="row g-0">
                                        <div class="col-md-6">
                                            <ul class="list-group mb-0">
                                                <li class="list-group-item border-0 ps-0 py-1 d-flex align-items-center">
                                                    <i data-lucide="check-circle" class="text-success me-2 flex-shrink-0" style="width: 16px; height: 16px;"></i>
                                                    <span>Access account information</span>
                                                </li>
                                                <li class="list-group-item border-0 ps-0 py-1 d-flex align-items-center">
                                                    <i data-lucide="check-circle" class="text-success me-2 flex-shrink-0" style="width: 16px; height: 16px;"></i>
                                                    <span>View transaction history</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="list-group mb-0">
                                                <li class="list-group-item border-0 ps-0 py-1 d-flex align-items-center">
                                                    <i data-lucide="check-circle" class="text-success me-2 flex-shrink-0" style="width: 16px; height: 16px;"></i>
                                                    <span>Match transactions to invoices</span>
                                                </li>
                                                <li class="list-group-item border-0 ps-0 py-1 d-flex align-items-center text-muted">
                                                    <i data-lucide="x-circle" class="text-muted me-2 flex-shrink-0" style="width: 16px; height: 16px;"></i>
                                                    <span>No permission to move money</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="auth-info border rounded p-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <i data-lucide="shield-check" class="text-success me-2 flex-shrink-0" style="width: 20px; height: 20px;"></i>
                                        <h6 class="mb-0">Secure Connection</h6>
                                    </div>
                                    <p class="text-muted small mb-0">Your credentials are never stored. We use Open Banking APIs to securely connect to your bank account.</p>
                                </div>
                                
                                <div class="bank-preview mt-3 text-center p-3 border rounded">
                                    <div class="d-flex justify-content-center mb-2">
                                        <img src="https://via.placeholder.com/80x80.png?text=Bank" 
                                             alt="Bank Logo" 
                                             class="bank-preview-logo mb-2" 
                                             style="max-height: 48px; max-width: 80%; display: none;">
                                        <div class="bank-logo d-inline-flex align-items-center justify-content-center bg-light rounded-circle" 
                                             style="width: 48px; height: 48px;">
                                            <i data-lucide="landmark" style="width: 24px; height: 24px;"></i>
                                        </div>
                                    </div>
                                    <h5 class="bank-name mb-1">Select a Bank</h5>
                                    <p class="text-muted small mb-0">You'll be redirected to the bank's secure login page</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 3: Complete -->
                    <div class="step-content step-3 d-none">
                        <div class="row align-items-center">
                            <div class="col-md-6 text-center text-md-start">
                                <i data-lucide="check-circle" style="width: 48px; height: 48px;" class="mb-3 text-success"></i>
                                <h5 class="mb-3">Connection Complete</h5>
                                <p class="text-muted">Your bank account has been successfully connected.</p>
                                
                                <div class="connected-account border rounded p-3 mb-3 d-flex align-items-center">
                                    <div class="d-flex align-items-center me-3">
                                        <img src="https://via.placeholder.com/80x80.png?text=Bank" 
                                             alt="Bank Logo" 
                                             class="bank-preview-logo"
                                             style="max-height: 40px; max-width: 80px; display: none;">
                                        <div class="bank-logo bg-light rounded-circle d-flex align-items-center justify-content-center" 
                                             style="width: 40px; height: 40px; min-width: 40px;">
                                            <i data-lucide="landmark" style="width: 20px; height: 20px;"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">Connected Bank</h6>
                                        <p class="mb-0 small text-muted">Primary Account</p>
                                    </div>
                                    <span class="badge bg-success">Connected</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="connection-info">
                                    <h6 class="mb-2">What happens next?</h6>
                                    <div class="alert alert-light border mb-0">
                                        <ol class="mb-0 ps-3">
                                            <li class="mb-2">We'll start importing your transactions automatically</li>
                                            <li class="mb-2">Transactions will be matched to invoices</li>
                                            <li>You'll receive notifications for any transactions that need review</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer py-2">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="bankWizardNextBtn" disabled>Continue to Authorization</button>
            </div>
        </div>
    </div>
</div>

<style>
.cursor-pointer {
    cursor: pointer;
}

.wizard-progress {
    position: relative;
    padding-top: 30px;
}

.step {
    text-align: center;
    z-index: 1;
    flex: 1;
}

.step-icon {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin: 0 auto 8px;
    font-size: 12px;
}

.step-label {
    font-size: 12px;
    color: var(--bs-gray-600);
}

.bank-option {
    transition: all 0.3s ease;
}

.bank-option:hover {
    border-color: var(--bs-primary) !important;
    background-color: rgba(var(--bs-primary-rgb), 0.05);
}

.auth-info {
    background-color: rgba(var(--bs-success-rgb), 0.05);
}

.bank-logo {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.step-number {
    width: 24px;
    height: 24px;
    background-color: var(--bs-primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
}
</style>