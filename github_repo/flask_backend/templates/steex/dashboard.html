{% extends "steex/base.html" %}
{% block title %}Dashboard - Payymo{% endblock title %}

{% block extra_css %}
<!-- jsvectormap css -->
<link href="{{ url_for('static', filename='libs/jsvectormap/css/jsvectormap.min.css') }}" rel="stylesheet" type="text/css">

<!--Swiper slider css-->
<link href="{{ url_for('static', filename='libs/swiper/swiper-bundle.min.css') }}" rel="stylesheet" type="text/css">
{% endblock extra_css %}

{% block page_title %}Dashboard{% endblock page_title %}
{% block breadcrumb_page %}Dashboard{% endblock breadcrumb_page %}

{% block content %}
<!-- Finance Overview Section -->
<div class="row" data-container-id="finance-overview">
    <div class="col-xl-3 col-md-6" data-container-id="total-transactions">
        <div class="card card-animate" data-container-type="data-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-primary-subtle text-primary rounded-2 fs-2">
                            <i class="mdi mdi-bank-transfer"></i>
                        </span>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <p class="text-uppercase fw-medium text-muted mb-0">Total Transactions</p>
                        <h4 class="fs-4 mb-0"><span class="counter-value" data-target="8754">0</span></h4>
                    </div>
                    <div class="flex-shrink-0 align-self-center">
                        <span class="badge bg-success-subtle text-success fs-12"><i class="ri-arrow-up-s-line fs-13 align-middle me-1"></i>16.24 %<span></span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6" data-container-id="matched-transactions">
        <div class="card card-animate" data-container-type="data-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-success-subtle text-success rounded-2 fs-2">
                            <i class="mdi mdi-check-decagram"></i>
                        </span>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <p class="text-uppercase fw-medium text-muted mb-0">Matched Transactions</p>
                        <h4 class="fs-4 mb-0"><span class="counter-value" data-target="7234">0</span></h4>
                    </div>
                    <div class="flex-shrink-0 align-self-center">
                        <span class="badge bg-success-subtle text-success fs-12"><i class="ri-arrow-up-s-line fs-13 align-middle me-1"></i>8.42 %<span></span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6" data-container-id="unmatched-transactions">
        <div class="card card-animate" data-container-type="data-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-warning-subtle text-warning rounded-2 fs-2">
                            <i class="mdi mdi-alert-circle"></i>
                        </span>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <p class="text-uppercase fw-medium text-muted mb-0">Unmatched Transactions</p>
                        <h4 class="fs-4 mb-0"><span class="counter-value" data-target="1520">0</span></h4>
                    </div>
                    <div class="flex-shrink-0 align-self-center">
                        <span class="badge bg-danger-subtle text-danger fs-12"><i class="ri-arrow-down-s-line fs-13 align-middle me-1"></i>3.96 %<span></span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6" data-container-id="total-reconciled">
        <div class="card card-animate" data-container-type="data-card">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="avatar-sm flex-shrink-0">
                        <span class="avatar-title bg-info-subtle text-info rounded-2 fs-2">
                            <i class="mdi mdi-currency-gbp"></i>
                        </span>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <p class="text-uppercase fw-medium text-muted mb-0">Total Reconciled</p>
                        <h4 class="fs-4 mb-0">£<span class="counter-value" data-target="256874">0</span></h4>
                    </div>
                    <div class="flex-shrink-0 align-self-center">
                        <span class="badge bg-success-subtle text-success fs-12"><i class="ri-arrow-up-s-line fs-13 align-middle me-1"></i>10.33 %<span></span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Transaction Activity Section -->
<div class="row" data-container-id="transaction-activity">
    <div class="col-xl-8" data-container-id="transaction-activity-chart">
        <div class="card" data-container-type="chart">
            <div class="card-header border-0 align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Transaction Activity</h4>
                <div>
                    <button type="button" class="btn btn-soft-secondary btn-sm">
                        ALL
                    </button>
                    <button type="button" class="btn btn-soft-secondary btn-sm">
                        1M
                    </button>
                    <button type="button" class="btn btn-soft-secondary btn-sm">
                        6M
                    </button>
                    <button type="button" class="btn btn-soft-primary btn-sm">
                        1Y
                    </button>
                </div>
            </div>
            <div class="card-body p-0 pb-2">
                <div>
                    <div id="transaction-activity-chart" data-colors='["--bs-primary", "--bs-warning"]' class="apex-charts" dir="ltr" style="min-height: 320px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4" data-container-id="recent-activity">
        <div class="card" data-container-type="data-card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Recent Activity</h4>
                <div class="flex-shrink-0">
                    <div class="dropdown card-header-dropdown">
                        <a class="text-reset dropdown-btn" href="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="fw-semibold text-uppercase fs-12">Sort by: </span><span class="text-muted">Current Week<i class="mdi mdi-chevron-down ms-1"></i></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="#">Today</a>
                            <a class="dropdown-item" href="#">Yesterday</a>
                            <a class="dropdown-item" href="#">Current Week</a>
                            <a class="dropdown-item" href="#">Last Week</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-body pt-0">
                <div class="table-responsive table-card">
                    <table class="table align-middle table-borderless table-centered table-nowrap mb-0">
                        <thead class="text-muted table-light">
                            <tr>
                                <th scope="col">Transaction ID</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Date</th>
                                <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#TXN-5473</a>
                                </td>
                                <td>£245.20</td>
                                <td>25 Mar, 2025</td>
                                <td><span class="badge bg-success-subtle text-success">Matched</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#TXN-5472</a>
                                </td>
                                <td>£89.50</td>
                                <td>24 Mar, 2025</td>
                                <td><span class="badge bg-success-subtle text-success">Matched</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#TXN-5471</a>
                                </td>
                                <td>£124.99</td>
                                <td>24 Mar, 2025</td>
                                <td><span class="badge bg-warning-subtle text-warning">Pending</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#TXN-5470</a>
                                </td>
                                <td>£542.00</td>
                                <td>23 Mar, 2025</td>
                                <td><span class="badge bg-success-subtle text-success">Matched</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#TXN-5469</a>
                                </td>
                                <td>£75.25</td>
                                <td>22 Mar, 2025</td>
                                <td><span class="badge bg-danger-subtle text-danger">Unmatched</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bank Connections & Invoice Matches -->
<div class="row" data-container-id="connections-matches">
    <div class="col-xl-4" data-container-id="bank-connections">
        <div class="card" data-container-type="data-card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Bank Connections</h4>
                <div class="flex-shrink-0">
                    <button type="button" class="btn btn-sm btn-soft-primary">
                        <i class="ri-add-line align-bottom"></i> Add Bank
                    </button>
                </div>
            </div>

            <div class="card-body">
                <div class="table-responsive table-card">
                    <table class="table table-hover table-centered align-middle table-nowrap mb-0">
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="{{ url_for('static', filename='images/banks/barclays.png') }}" alt="" class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Barclays Bank</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Active</span></td>
                                <td>
                                    <div class="hstack gap-3 flex-wrap">
                                        <a href="#" class="link-success fs-15"><i class="ri-edit-2-line"></i></a>
                                        <a href="#" class="link-danger fs-15"><i class="ri-delete-bin-line"></i></a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="{{ url_for('static', filename='images/banks/lloyds.png') }}" alt="" class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Lloyds Bank</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Active</span></td>
                                <td>
                                    <div class="hstack gap-3 flex-wrap">
                                        <a href="#" class="link-success fs-15"><i class="ri-edit-2-line"></i></a>
                                        <a href="#" class="link-danger fs-15"><i class="ri-delete-bin-line"></i></a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="{{ url_for('static', filename='images/banks/hsbc.png') }}" alt="" class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">HSBC UK</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-warning-subtle text-warning">Expired</span></td>
                                <td>
                                    <div class="hstack gap-3 flex-wrap">
                                        <a href="#" class="link-primary fs-15"><i class="ri-refresh-line"></i></a>
                                        <a href="#" class="link-danger fs-15"><i class="ri-delete-bin-line"></i></a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4" data-container-id="stripe-connections">
        <div class="card" data-container-type="data-card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Stripe Accounts</h4>
                <div class="flex-shrink-0">
                    <button type="button" class="btn btn-sm btn-soft-primary">
                        <i class="ri-add-line align-bottom"></i> Add Account
                    </button>
                </div>
            </div>

            <div class="card-body">
                <div class="table-responsive table-card">
                    <table class="table table-hover table-centered align-middle table-nowrap mb-0">
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="{{ url_for('static', filename='images/stripe.png') }}" alt="" class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Main Stripe Account</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Active</span></td>
                                <td>
                                    <div class="hstack gap-3 flex-wrap">
                                        <a href="#" class="link-success fs-15"><i class="ri-edit-2-line"></i></a>
                                        <a href="#" class="link-danger fs-15"><i class="ri-delete-bin-line"></i></a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0 me-2">
                                            <img src="{{ url_for('static', filename='images/stripe.png') }}" alt="" class="avatar-xs rounded-circle" />
                                        </div>
                                        <div class="flex-grow-1">Development Account</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-success-subtle text-success">Active</span></td>
                                <td>
                                    <div class="hstack gap-3 flex-wrap">
                                        <a href="#" class="link-success fs-15"><i class="ri-edit-2-line"></i></a>
                                        <a href="#" class="link-danger fs-15"><i class="ri-delete-bin-line"></i></a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-4" data-container-id="invoice-matches">
        <div class="card" data-container-type="data-card">
            <div class="card-header align-items-center d-flex">
                <h4 class="card-title mb-0 flex-grow-1">Recent Invoice Matches</h4>
                <div class="flex-shrink-0">
                    <a href="#" class="btn btn-sm btn-soft-info">
                        View All
                    </a>
                </div>
            </div>

            <div class="card-body">
                <div class="table-responsive table-card">
                    <table class="table table-borderless table-centered align-middle table-nowrap mb-0">
                        <thead class="text-muted table-light">
                            <tr>
                                <th scope="col">Invoice ID</th>
                                <th scope="col">Transaction</th>
                                <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#INV-1234</a>
                                </td>
                                <td>#TXN-5473</td>
                                <td><span class="badge bg-success-subtle text-success">Approved</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#INV-1235</a>
                                </td>
                                <td>#TXN-5472</td>
                                <td><span class="badge bg-success-subtle text-success">Approved</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#INV-1236</a>
                                </td>
                                <td>#TXN-5471</td>
                                <td><span class="badge bg-warning-subtle text-warning">Pending</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <a href="#" class="fw-medium">#INV-1237</a>
                                </td>
                                <td>#TXN-5470</td>
                                <td><span class="badge bg-success-subtle text-success">Approved</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_javascript %}
<!-- apexcharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<!-- Vector map-->
<script src="{{ url_for('static', filename='libs/jsvectormap/js/jsvectormap.min.js') }}"></script>
<script src="{{ url_for('static', filename='libs/jsvectormap/maps/world-merc.js') }}"></script>

<!--Swiper slider js-->
<script src="{{ url_for('static', filename='libs/swiper/swiper-bundle.min.js') }}"></script>

<!-- Dashboard init -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Transaction Activity Chart
    var options = {
        series: [{
            name: 'Bank Transactions',
            type: 'column',
            data: [23, 45, 67, 34, 56, 78, 98, 34, 67, 23, 45, 67]
        }, {
            name: 'Stripe Payments',
            type: 'line',
            data: [34, 28, 67, 45, 67, 34, 56, 45, 89, 34, 45, 78]
        }],
        chart: {
            height: 320,
            type: 'line',
            toolbar: {
                show: false,
            }
        },
        stroke: {
            curve: 'smooth',
            width: [0, 3]
        },
        fill: {
            opacity: [1, 1]
        },
        markers: {
            size: [0, 4],
            strokeWidth: 2,
            hover: {
                size: 6
            }
        },
        xaxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            axisTicks: {
                show: false
            },
            axisBorder: {
                show: false
            }
        },
        grid: {
            show: true,
            borderColor: '#90A4AE',
            strokeDashArray: 0,
            position: 'back',
            xaxis: {
                lines: {
                    show: false
                }
            },
            yaxis: {
                lines: {
                    show: true
                }
            },
            row: {
                colors: undefined,
                opacity: 0.1
            },
            column: {
                colors: undefined,
                opacity: 0.1
            },
            padding: {
                top: 0,
                right: 0,
                bottom: 0,
                left: 0
            }
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        colors: ['#3366cc', '#ff9900']
    };

    var chart = new ApexCharts(document.querySelector("#transaction-activity-chart"), options);
    chart.render();

    // Counter animation
    var counterElements = document.querySelectorAll('.counter-value');
    counterElements.forEach(function(element) {
        var target = parseInt(element.dataset.target);
        var duration = 2000; // 2 seconds
        var startTime = null;
        
        function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            var progress = timestamp - startTime;
            var percentage = Math.min(progress / duration, 1);
            
            var value = Math.floor(percentage * target);
            element.textContent = value.toLocaleString();
            
            if (percentage < 1) {
                window.requestAnimationFrame(animate);
            }
        }
        
        window.requestAnimationFrame(animate);
    });
});
</script>
{% endblock extra_javascript %}